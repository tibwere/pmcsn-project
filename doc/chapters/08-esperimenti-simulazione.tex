\chapter{Esperimenti di simulazione}\label{chp:esperimenti-simulazione}
In accordo agli obiettivi dello studio, per la progettazione degli esperimenti di simulazione, è stata considerata unicamente l'analisi dello stato transiente del sistema. Infatti, perderebbe di significato considerare lo stato stazionario per determinare il numero minimo di serventi necessari affinché vengano soddisfatti i QoS descritti nel capitolo \ref{chp:obiettivi}. Questo perché in una giornata lavorativa il sistema non riesce a raggiungere lo stato stazionario prima che si verifichi la condizione di scarico (\textit{"close the door"}) ed inoltre rimane forte l'influenza delle condizioni iniziali. 

Per completezza, nella sezione \ref{sec:esperimenti-simulazione-stazionario} è mostrato il raggiungimento della stazionarietà da parte del sistema. 

\section{Progetto degli esperimenti}\label{sec:esperimenti-simulazione-1}
Per realizzare l'analisi transiente del sistema è stata adottata la tecnica \textit{replication}, dove:
\begin{itemize}
\item Il numero di repliche adottato nella simulazione (\texttt{ENSEMBLE\_SIZE}) è pari a \texttt{10000}, scelto con l'obiettivo di perdere la dipendenza dal seme iniziale.
\item Il seme adottato (\texttt{TERM\_INIT\_SEED}) è pari a \texttt{9}, settato unicamente ad inizio simulazione al fine di evitare di generare più volte le stesse sequenze di variate pseudocasuali. Infatti, se si scegliesse manualmente il seed di ciascuna replica, potrebbe verificarsi un overlap nella generazione.
\item \texttt{START = 0} e \texttt{STOP = 480} come descritto in sezione \ref{sec:modello-computazionale-clock}.
\end{itemize}

Inoltre:
\begin{itemize}
\item È stato utilizzato il programma \texttt{estimate} per il calcolo delle realizzazioni degli intervalli di confidenza al 95\%.
\item È stato utilizzato il programma \texttt{uvs} per il calcolo di media e deviazione standard.
\end{itemize}

Di seguito sono riportate le descrizioni degli esperimenti di simulazione compiuti, per ciascuno dei quali è stata adottata la tecnica \textit{replication} appena illustrata.

\subsection*{Numero minimo di sportelli}
Per individuare il numero minimo $M^*$ di sportelli da mantenere operativi in una giornata lavorativa, al fine di soddisfare i QoS (cap. \ref{chp:obiettivi}), un primo esperimento condotto è stato quello di analizzare l'attesa media di ciascuna classe d'utenza al variare di $M$.

A tal proposito, è stato simulato il sistema per un'intera giornata di lavoro, assumendo che i clienti iniziassero ad arrivare all'ufficio postale \textbf{solo} successivamente all'apertura (sistema inizialmente scarico).

\subsection*{Andamento dell'attesa nell'arco della giornata}
Una volta individuato il valore $M^*$, è stata studiata l'evoluzione dell'attesa media per ciascuna classe d'utenza all'avanzare del tempo di simulazione.

Per realizzare quest'esperimento è stata eseguita una campionatura oraria delle statistiche, ovvero sono state effettuate:
\begin{itemize}
\item 10000 repliche in cui il campionamento avviene al $60$-esimo minuto di simulazione
\item 10000 repliche in cui il campionamento avviene al $120$-esimo minuto di simulazione
\item $\dots$
\item 10000 repliche in cui il campionamento avviene al $480$-esimo minuto di simulazione
\end{itemize}
dove la procedura utilizzata per inferire le statistiche è quella illustrata nel capitolo \ref{sec:modello-computazionale-campionamento-stat}.
	
\section{Esecuzione degli esperimenti ed analisi degli output}
\subsection*{Numero minimo di sportelli}
I risultati dell'esperimento condotto sono riportati sia in forma tabellare (tab. \ref{table:esperimenti-simulazione-1}) che in forma grafica (fig. \ref{fig:esperimenti-simulazione-1}).

È immediato osservare che per rispettare i requisiti di qualità stabiliti nel capitolo \ref{chp:obiettivi}, mostrati nei grafici tramite linee rosse tratteggiate, il numero minimo di serventi è $M^* = 4$. Infatti, dalla figura \ref{fig:esperimenti-simulazione-1d} si evince che con $M = 3$ non è possibile rispettare il QoS (in tabella \ref{table:esperimenti-simulazione-1b} è evidenziato in {\color{red}rosso} il valore di  attesa che lo supera).

\subsection*{Andamento dell'attesa nell'arco della giornata}
I risultati dell'esperimento condotto sono riportati sia in forma tabellare (tab. \ref{table:esperimenti-simulazione-2}) che in forma grafica (fig. \ref{fig:esperimenti-simulazione-2}).

Dai risultati ottenuti si evince l'esistenza di una correlazione tra la pendenza delle curve e il tasso d'arrivo della classe d'utenza corrispondente. La spiegazione di questo fenomeno è data dal fatto che flussi caratterizzati da un inferiore frequenza d'arrivo impiegano meno tempo a stabilizzarsi.

Ad esempio, si può osservare che le curve relative all'attesa media delle classi d'utenza \uo{} \textsl{Standard} e \pp{} \textsl{Standard} (figg. \ref{fig:esperimenti-simulazione-2c} e \ref{fig:esperimenti-simulazione-2d}) hanno una pendenza minore rispetto a quelle relative ai flussi \uo{} \textsl{BancoPosta} e \pp{} \textsl{BancoPosta} (figg. \ref{fig:esperimenti-simulazione-2a} e \ref{fig:esperimenti-simulazione-2b}). Infatti, le probabilità che un utente appartenga alle suddette classi sono:
\begin{equation*}
\begin{array}{l l l l l l}
p_{UO} \cdot p_{BP} & = & 0.125, & p_{PP} \cdot p_{BP} & = & 0.0875, \\
p_{UO} \cdot (1 - p_{BP}) & = & 0.375, & p_{PP} \cdot (1 - p_{BP}) & = & 0.2625
\end{array}
\end{equation*}
dove $p_{UO}$, $p_{PP}$ e $p_{BP}$ sono le probabilità definite nel modello delle specifiche (cap. \ref{chp:modello-specifiche}).

Inoltre, è possibile osservare che con quattro serventi l'attesa media di ciascuna classe di utenza mostra un incremento che preserva l'ordine di grandezza iniziale.

\section{Raggiungimento dello stato stazionario}\label{sec:esperimenti-simulazione-stazionario}
Per mostrare il raggiungimento dello stato stazionario da parte del sistema è stata adottata la tecnica \textit{batch means}, utilizzando i seguenti parametri:
\begin{itemize}
\item \texttt{STAT\_INIT\_SEED = 12345}.
\item \texttt{B = 960}, è stato notato essere il giusto compromesso fra il mantenimento della variabilità naturale del fenomeno osservato e l'indipendenza tra batch successivi.
\item \texttt{K = 64}, come da linee guida, al fine di rendere le statistiche campionate indipendenti dalle condizioni iniziali ed ottenere intervalli di confidenza significativi.
\item \texttt{START = 0} e $\mathtt{STOP = B \cdot K = 61440}$.
\end{itemize}

Inoltre, è stato utilizzato il programma \texttt{estimate} per il calcolo delle realizzazioni degli intervalli di confidenza.

I risultati riportati sia in forma tabellare (tab. \ref{table:esperimenti-simulazione-4}) che in forma grafica (fig. \ref{fig:esperimenti-simulazione-4}) mostrano l'andamento dell'attesa media:
\begin{itemize}
\item Per ticket di tipo \uo{} e \pp{} (tab. \ref{table:esperimenti-simulazione-4a} e fig. \ref{fig:esperimenti-simulazione-4a})
\item Per ticket di tipo \sr{} (tab. \ref{table:esperimenti-simulazione-4a} e fig. \ref{fig:esperimenti-simulazione-4b})
\end{itemize}
al variare del numero di batch considerati fino a raggiungere il valore di \texttt{K} sopra definito.

I dati raccolti confermano quanto detto ad inizio capitolo, ovvero è possibile raggiungere lo stato stazionario soltanto prendendo in considerazione finestre temporali più ampie dei $480\ min$ giornalieri.

\newpage
\section{Grafici e tabelle}
\subsection*{Numero minimo di sportelli}
\captionsetup[table]{justification=centering}
\begin{table}[ht]
\centering
\begin{subtable}{0.5\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|c|}
\hline
$c$ & $\bar{d}_c$ & $s_c$ & $w$\\
\hline
0 & 6.924 & 3.068 & 0.06 \\
\hline
1 & 10.064 & 6.333 & 0.12 \\
\hline
2 & 28.191 & 20.506 & 0.40 \\
\hline
3 & 141.439 & 81.084 & 1.59 \\
\hline
4 & 10.251 & 7.008 & 0.14 \\
\hline
5 & 15.865 & 8.988 & 0.18 \\
\hline
\end{tabular}}
\caption{$M = 2$}
\end{subtable}%
\begin{subtable}{0.5\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|c|}
\hline
$c$ & $\bar{d}_c$ & $s_c$ & $w$\\
\hline
0 & 2.567 & 1.594 & 0.03 \\
\hline
1 & 3.119 & 2.379 & 0.05 \\
\hline
2 & 5.619 & 4.178 & 0.08 \\
\hline
3 & {\color{red}16.162} & {\color{red}17.656} & {\color{red}0.35} \\
\hline
4 & 8.436 & 6.945 & 0.14 \\
\hline
5 & 13.029 & 9.144 & 0.18 \\
\hline
\end{tabular}}
\caption{$M = 3$}
\label{table:esperimenti-simulazione-1b}
\end{subtable}
\begin{subtable}{0.5\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|c|}
\hline
$c$ & $\bar{d}_c$ & $s_c$ & $w$\\
\hline
0 & 0.780 & 0.756 & 0.01 \\
\hline
1 & 0.881 & 1.027 & 0.02 \\
\hline
2 & 1.347 & 1.274 & 0.02 \\
\hline
3 & 2.496 & 3.126 & 0.06 \\
\hline
4 & 6.224 & 6.256 & 0.12 \\
\hline
5 & 9.451 & 8.221 & 0.16 \\
\hline
\end{tabular}}
\caption{$M = 4$}
\end{subtable}
\caption{Media ($\bar{d}_c$), deviazione standard ($s_c$) e ampiezza dell'intervallo di confidenza al 95\% ($w$) per l'attesa (espressa in minuti) di ciascuna classe d'utenza $c$, al variare di $M$}
\label{table:esperimenti-simulazione-1}
\end{table}

\captionsetup[figure]{justification=centering}
\begin{figure}[ht]
\centering
\begin{subfigure}[b]{0.475\textwidth}
\centering
\includegraphics[width=\textwidth]{plots/d0-trans}
\caption{\uo{} \textsl{BancoPosta}}    
\end{subfigure}
\hfill    
\begin{subfigure}[b]{0.475\textwidth}  
\centering 
\includegraphics[width=\textwidth]{plots/d1-trans}
\caption{\pp{} \textsl{BancoPosta}}    
\end{subfigure}

\vskip\baselineskip

\begin{subfigure}[b]{0.475\textwidth}   
\centering 
\includegraphics[width=\textwidth]{plots/d2-trans}
\caption{\uo{} \textsl{Standard}}    
\end{subfigure}
\hfill
\begin{subfigure}[b]{0.475\textwidth}   
\centering 
\includegraphics[width=\textwidth]{plots/d3-trans}
\caption{\pp{} \textsl{Standard}}
\label{fig:esperimenti-simulazione-1d}  
\end{subfigure}

\vskip\baselineskip

\begin{subfigure}[b]{0.475\textwidth}   
\centering 
\includegraphics[width=\textwidth]{plots/d4-trans}
\caption{\sr{} \textsl{BancoPosta}}    
\end{subfigure}
\hfill
\begin{subfigure}[b]{0.475\textwidth}   
\centering 
\includegraphics[width=\textwidth]{plots/d5-trans}
\caption{\sr{} \textsl{Standard}}    
\end{subfigure}
\caption{Intervalli di confidenza al 95\% per l'attesa media (espressa in minuti) di ciascuna classe d'utenza, al variare di $M$}
\label{fig:esperimenti-simulazione-1}
\end{figure}

\subsection*{Andamento dell'attesa nell'arco della giornata}
\captionsetup[table]{justification=centering}
\begin{table}[ht]
\centering
\begin{subtable}[t]{0.33\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|c|}
\hline
$t$ & $\bar{d}_0$ & $s_0$ & $w$\\
\hline
60 & 0.398 & 1.484 & 0.03 \\
\hline
120 & 0.640 & 1.494 & 0.03 \\
\hline
180 & 0.719 & 1.310 & 0.03 \\
\hline
240 & 0.745 & 1.127 & 0.02 \\
\hline
300 & 0.756 & 0.952 & 0.02 \\
\hline
360 & 0.772 & 0.876 & 0.02 \\
\hline
420 & 0.784 & 0.815 & 0.02 \\
\hline
480 & 0.795 & 0.772 & 0.02 \\
\hline
\end{tabular}}
\caption{\uo{} \textsl{BancoPosta}}
\end{subtable}%
\begin{subtable}[t]{0.33\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|c|}
\hline
$t$ & $\bar{d}_1$ & $s_1$ & $w$\\
\hline
60 & 0.331 & 1.534 & 0.03 \\
\hline
120 & 0.676 & 2.239 & 0.04 \\
\hline
180 & 0.795 & 1.862 & 0.04 \\
\hline
240 & 0.833 & 1.484 & 0.03 \\
\hline
300 & 0.860 & 1.336 & 0.03 \\
\hline
360 & 0.885 & 1.255 & 0.02 \\
\hline
420 & 0.900 & 1.157 & 0.02 \\
\hline
480 & 0.915 & 1.084 & 0.02 \\
\hline
\end{tabular}}
\caption{\pp{} \textsl{BancoPosta}}
\end{subtable}%
\begin{subtable}[t]{0.33\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|c|}
\hline
$t$ & $\bar{d}_2$ & $s_2$ & $w$\\
\hline
60 & 0.825 & 2.709 & 0.05 \\
\hline
120 & 1.084 & 2.228 & 0.04 \\
\hline
180 & 1.174 & 1.890 & 0.04 \\
\hline
240 & 1.237 & 1.695 & 0.03 \\
\hline
300 & 1.286 & 1.544 & 0.03 \\
\hline
360 & 1.320 & 1.451 & 0.03 \\
\hline
420 & 1.347 & 1.382 & 0.03 \\
\hline
480 & 1.366 & 1.298 & 0.03 \\
\hline
\end{tabular}}
\caption{\uo{} \textsl{Standard}}
\end{subtable}

\vskip\baselineskip

\begin{subtable}[b]{0.33\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|c|}
\hline
$t$ & $\bar{d}_3$ & $s_3$ & $w$\\
\hline
60 & 1.427 & 6.074 & 0.12 \\
\hline
120 & 1.918 & 5.212 & 0.10 \\
\hline
180 & 2.185 & 4.948 & 0.10 \\
\hline
240 & 2.289 & 4.298 & 0.08 \\
\hline
300 & 2.391 & 3.862 & 0.08 \\
\hline
360 & 2.472 & 3.647 & 0.07 \\
\hline
420 & 2.523 & 3.450 & 0.07 \\
\hline
480 & 2.577 & 3.273 & 0.06 \\
\hline
\end{tabular}}
\caption{\pp{} \textsl{Standard}}
\end{subtable}%
\begin{subtable}[b]{0.33\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|c|}
\hline
$t$ & $\bar{d}_4$ & $s_4$ & $w$\\
\hline
60 & 0.961 & 3.753 & 0.07 \\
\hline
120 & 3.191 & 7.631 & 0.15 \\
\hline
180 & 4.554 & 9.024 & 0.18 \\
\hline
240 & 5.415 & 8.332 & 0.16 \\
\hline
300 & 5.903 & 8.151 & 0.16 \\
\hline
360 & 6.231 & 7.833 & 0.15 \\
\hline
420 & 6.321 & 7.201 & 0.14 \\
\hline
480 & 6.472 & 6.875 & 0.13 \\
\hline
\end{tabular}}
\caption{\sr{} \textsl{BancoPosta}}
\end{subtable}%
\begin{subtable}[b]{0.33\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|c|}
\hline
$t$ & $\bar{d}_5$ & $s_5$ & $w$\\
\hline
60 & 3.580 & 10.066 & 0.20 \\
\hline
120 & 7.873 & 16.620 & 0.33 \\
\hline
180 & 8.816 & 14.473 & 0.28 \\
\hline
240 & 9.164 & 13.613 & 0.27 \\
\hline
300 & 9.326 & 12.158 & 0.24 \\
\hline
360 & 9.401 & 9.778 & 0.19 \\
\hline
420 & 9.585 & 9.718 & 0.19 \\
\hline
480 & 9.807 & 9.579 & 0.19 \\
\hline
\end{tabular}}
\caption{\sr{} \textsl{Standard}}
\end{subtable}
\caption{Istante di campionamento ($t$), media ($\bar{d}_c$), deviazione standard ($s_c$) e ampiezza dell'intervallo di confidenza al 95\% ($w$) per l'attesa (espressa in minuti) di ciascuna classe d'utenza $c$}
\label{table:esperimenti-simulazione-2}
\end{table}

\begin{figure}[ht]
\centering
\begin{subfigure}[b]{0.475\textwidth}
\centering
\includegraphics[width=\textwidth]{plots/day-from-empty-0}
\caption{\uo{} \textsl{BancoPosta}}    
\label{fig:esperimenti-simulazione-2a}
\end{subfigure}
\hfill    
\begin{subfigure}[b]{0.475\textwidth}  
\centering 
\includegraphics[width=\textwidth]{plots/day-from-empty-1}
\caption{\pp{} \textsl{BancoPosta}}
\label{fig:esperimenti-simulazione-2b} 
\end{subfigure}

\vskip\baselineskip

\begin{subfigure}[b]{0.475\textwidth}   
\centering 
\includegraphics[width=\textwidth]{plots/day-from-empty-2}
\caption{\uo{} \textsl{Standard}}
\label{fig:esperimenti-simulazione-2c}
\end{subfigure}
\hfill
\begin{subfigure}[b]{0.475\textwidth}   
\centering 
\includegraphics[width=\textwidth]{plots/day-from-empty-3}
\caption{\pp{} \textsl{Standard}}    
\label{fig:esperimenti-simulazione-2d}
\end{subfigure}

\vskip\baselineskip

\begin{subfigure}[b]{0.475\textwidth}   
\centering 
\includegraphics[width=\textwidth]{plots/day-from-empty-4}
\caption{\sr{} \textsl{BancoPosta}}    
\end{subfigure}
\hfill
\begin{subfigure}[b]{0.475\textwidth}   
\centering 
\includegraphics[width=\textwidth]{plots/day-from-empty-5}
\caption{\sr{} \textsl{Standard}}    
\end{subfigure}
\caption{Intervalli di confidenza al 95\% per l'attesa media (espressa in minuti) di ciascuna classe d'utenza, al variare dell'istante di campionamento}
\label{fig:esperimenti-simulazione-2}
\end{figure}

\subsection*{Raggiungimento dello stato stazionario}
\begin{table}[ht]
\centering
\begin{subtable}{0.475\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|}
\hline
$K$ & Media & Dev. std. \\
\hline
1 & 20.258 & - \\
\hline
2 & 16.041 & 4.217 \\
\hline
4 & 17.105 & 3.303 \\
\hline
8 & 40.237 & 37.398 \\
\hline
16 & 37.644 & 28.445 \\
\hline
32 & 35.328 & 34.331 \\
\hline
64 & 29.543 & 27.305 \\	
\hline
\end{tabular}}
\caption{\uo{} e \pp{}}
\label{table:esperimenti-simulazione-4a}
\end{subtable}%
\begin{subtable}{0.475\textwidth}
\centering
{\tablecolors
\begin{tabular}{|c|c|c|}
\hline
$K$ & Media & Dev. std. \\
\hline
1 & 29.430 & - \\
\hline
2 & 25.126 & 4.304 \\
\hline
4 & 27.608 & 4.663 \\
\hline
8 & 27.065 & 9.396 \\
\hline
16 & 30.917 & 14.156 \\
\hline
32 & 30.592 & 24.059 \\
\hline
64 & 30.642 & 18.991 \\
\hline
\end{tabular}}
\caption{\sr{}}
\label{table:esperimenti-simulazione-4b}
\end{subtable}
\caption{Raggiungimento dello stato stazionario del sistema}
\label{table:esperimenti-simulazione-4}
\end{table}

\begin{figure}[ht]
\centering
\begin{subfigure}[b]{0.8\textwidth}
\centering
\includegraphics[width=\textwidth]{plots/d-staz-G-ic}
\caption{\uo{} e \pp{}}
\label{fig:esperimenti-simulazione-4a}
\end{subfigure}
\vskip\baselineskip    
\begin{subfigure}[b]{0.8\textwidth}  
\centering 
\includegraphics[width=\textwidth]{plots/d-staz-D-ic}
\caption{\sr{}}
\label{fig:esperimenti-simulazione-4b}
\end{subfigure}
\caption{Raggiungimento dello stato stazionario del sistema}
\label{fig:esperimenti-simulazione-4}
\end{figure}
